#include "DxLib.h"
#include "Keyboard.h"
#include "Enemy.h"
#include "Map.h"
#include "Game.h"

static const int NUM = 10;	//敵の数

Enemy_t m_Enemy[NUM];		//敵の実体
static int m_ImgEnemy;		//敵の画像ハンドル
static int image[16];

static bool inturn = false;
static bool check = false;

// 初期化をする
void EnemyMgr_Initialize() {
	LoadDivGraph("画像/キャラクタ11.png", 16, 4, 4, 32, 32, image);
	int x, y;
	calcenemy(&x, &y);
	Enemy_Initialize(&m_Enemy[0], x,y, image, 0);// 初期化
	calcenemy(&x, &y);
	Enemy_Initialize(&m_Enemy[1], x,y, image, 1);// 初期化
	calcenemy(&x, &y);
	Enemy_Initialize(&m_Enemy[2], x, y, image, 2);// 初期化
	calcenemy(&x, &y);
	Enemy_Initialize(&m_Enemy[3], x, y, image, 3);// 初期化
	calcenemy(&x, &y);
	Enemy_Initialize(&m_Enemy[4], x, y, image, 4);// 初期化
	calcenemy(&x, &y);
	Enemy_Initialize(&m_Enemy[5], x, y, image, 5);// 初期化
}

// 動きを計算する
void EnemyMgr_Update() {
	if (!turn) {
		if (!inturn) {
			inturn = true;
			for (int i = 0; i < NUM; i++) {//生きている敵全員にターンを渡す
				if (m_Enemy[i].alive) {
					m_Enemy[i].enemy_turn = false;
				}
			}
		}
		check = true;//この後の処理でcheckが変わらなければターンは終わっている
		for (int i = 0; i < NUM; i++) {
			Enemy_Update(&m_Enemy[i]);
			if (!m_Enemy[i].enemy_turn) {
				check = false;
			}
		}
		if (check) {
			inturn = false;
			turn = true;
		}

	}
}

// 描画する
void EnemyMgr_Draw() {
	for (int i = 0; i < NUM; i++) {
		Enemy_Draw(m_Enemy[i]);//描画
	}
}

// 終了処理をする
void EnemyMgr_Finalize() {
	for (int i = 0; i < NUM; i++) {
		Enemy_Finalize(m_Enemy[i]);//終了処理
	}

	DeleteGraph(m_ImgEnemy);    //画像を解放
}
